@inject ISudokuProvider SudokuProvider
@inject CandidatesMarkProvider CandidatesMarkProvider

<div class="mark__cell @_currentClass"></div>

@code {
    [Parameter]
    public int X { get; set; }

    [Parameter]
    public int Y { get; set; }

    [Parameter]
    public int Z { get; set; }

    private string _previousClass;
    private string _currentClass;

    protected override void OnInitialized()
    {
        SudokuProvider.OnCandidatesChanged += Update;
        CandidatesMarkProvider.OnChanged += Update;
    }

    private void Update()
    {
        _previousClass = _currentClass;
        var value = Z + 1;
        var cell = SudokuProvider.Cells[X, Y];
        var isIllegal = cell.Candidates.ContainsKey(value) && !cell.Candidates[value].IsLegal;
        _currentClass = isIllegal ? "mark__cell--danger" : string.Empty;

        if (_currentClass == string.Empty)
        {
             _currentClass = UI.BlazorWASM.Converters.CellColorConverter.ToCssClass(CandidatesMarkProvider.GetColor(X, Y, value));
        }

        if (_currentClass != _previousClass)
        {
            StateHasChanged();
        }
    }
}
